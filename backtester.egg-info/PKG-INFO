Metadata-Version: 2.4
Name: backtester
Version: 0.0.1
Summary: Deterministic trading backtester skeleton
Author: nicolas
License: MIT
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Operating System :: OS Independent
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: pydantic<3,>=2.4
Requires-Dist: polars>=0.20
Provides-Extra: dev
Requires-Dist: pytest==8.3.3; extra == "dev"
Requires-Dist: mypy==1.11.2; extra == "dev"
Requires-Dist: ruff==0.6.9; extra == "dev"
Requires-Dist: types-setuptools; extra == "dev"

# Backtester V2: Event-Driven Quantitative Trading Engine

<!-- Add Badges here: CI Status, Code Coverage, Python Version, License -->

## 1. Overview
Backtester V2 is an attempt for a high-fidelity, **event-driven** trading engine built for **crypto derivatives** (Spot, Futures, Options), however, the architecture is built to be asset-agnostic. Core features include a **deterministic** "tick-and-drain" event loop that guarantees reproducibility across runs. The backtester combines grandular tick-lvel simulation with decently a high-throughput using Polars and Parquet.

## 2. Key Features
### Simulation Fidelity
- **Latency Modeling:** Configurable Order RTT simulation to mimic realistic network delays ([`LatencyModel`](backtester/sim/sim_models.py)).
- **Execution Models:** Supports **Slippage** (Spread + POV) and Market Impact models defined in [ADR 017](adr/017-slippage-model-spread-pov.md).
- **Fee Structures:** Native support for Maker/Taker tiers and fixed BPS fee models ([`FeeModel`](backtester/sim/sim_models.py)).

### Architecture & Performance
- **Tick-and-Drain Loop:** A strict, deterministic event loop ([ADR 021](adr/021-micro-batch.md)) that guarantees reproducibility by resolving all events at time $T$ before advancing.
- **High-Throughput Data:** Leverages **Polars** and **Parquet** for efficient storage and querying of tick-level data.
- **Async Core:** Built on Python's `asyncio` for non-blocking I/O and responsive signal handling.

### Risk Management
- **Pre-Trade Checks:** Enforces exchange constraints like Max Notional, Lot Size, and Tick Size via [`SymbolSpecs`](backtester/core/ctx.py).

### Data Pipeline
historical data downloader (`backtester/data/downloader.py`) supporting:
- **Sources:** Binance (Spot, Futures, Options).
- **Integrity:** Automatic validation (negative prices, H/L checks) and sanitization.
- **Storage:** Parquet files partitioned by day with a central manifest.


## 3. System Architecture
The engine follows a **Modular Monolith** architecture ([ADR 009](adr/009-modular-monolith-over-microservices.md)) where distinct domains (Strategy, Risk, Execution, Account) are decoupled and communicate exclusively via an in-memory **Event Bus**.

### Event Bus Topology
Components publish and subscribe to typed topics, ensuring strict separation of concerns.
- **Strategy:** Subscribes to `T_CANDLES`, publishes `T_ORDERS_INTENT`.
- **Risk:** Intercepts intents, validates them, and publishes `T_ORDERS_SANITIZED`.
- **Execution:** Matches sanitized orders against market data and publishes `T_FILLS`.
- **Account:** Tracks state and publishes `T_ACCOUNT_SNAPSHOT`.

For a complete registry of topics and payloads, see [**Bus Topology & Module I/O**](docs/bus_topology.md).

## 4. Getting Started
### Prerequisites
<!-- Python 3.11+, Poetry, etc. -->

### Installation
<!-- to be added -->

### Running a Backtest
<!-- to be added -->

## 5. Strategy Implementation
<!--
Explain the `Strategy` interface (`on_candle`, `on_fill`).
Link to your best strategy code (e.g., `backtester/strategy/sma_extended.py`).
-->

## 6. Engineering Standards
This project adheres to strict engineering standards to ensure reliability and maintainability:

- **ADRs (Architecture Decision Records):** All major architectural decisions are documented in the `adr/` folder.
- **Determinism:** Every run is seeded and logged with the Git SHA. The "Tick-and-Drain" loop ensures that `Run(Config + Data + Seed)` always yields the exact same result.
- **Type Safety:** Fully typed codebase using Python type hints and `mypy` for static analysis.
- **Code Quality:** Enforced via `ruff` (linting/formatting) and `pre-commit` hooks.

## 7. Project Roadmap

### Core Engine & Simulation
### Backtesting

### Data & Analytics
- [ ] **Parameter Optimization:** Grid search and genetic algorithm runners for strategy tuning.
- [ ] **Historical Data Splitter** Helpers to split historical data into optimization & walk forward

### Live Trading & Infrastructure
- [ ] **Live Execution Adapter:** "Paper Trading" and "Live Trading" modes connecting to real exchange APIs.
- [ ] **Distributed Backtesting:** Parallel execution of backtests for large-scale parameter sweeps.
- [ ] **Web Dashboard:** A lightweight UI for monitoring active backtests and visualizing results.

## Closing Remarks
- **Testing** Due to my inexperience my designs kept changing wherefore I removed almost all tests. Tests will come back as soon as a stable interface is reached.
